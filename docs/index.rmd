---
title: "Non-stationary dynamics in Pacific salmon productivity"
author: "D. Greenberg, C. Wor, C. Holt, & B. Connors"
date: 'Nov. 2023'
output:
  html_document:
    collapsed: no
    fig_caption: yes
    highlight: espresso
    number_sections: yes
    smooth_scroll: yes
    theme: sandstone
    toc: yes
    toc_float: yes
---
```{=html}
<style type="text/css">

body{ /* Normal  */
      font-size: 13px;
  }
td {  /* Table  */
  font-size: 13px;
}
h1.title {
  font-size: 24px;
  color: Black;
}
h1 { /* Header 1 */
  font-size: 19px;
  color: Black;
}
h2 { /* Header 2 */
    font-size: 15px;
  color: Black;
}
h3 { /* Header 3 */
    font-size: 15px;
  color: Black;
}
</style>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

# Overview

This document contains additional figures exploring the characteristics of the spawner-recruitment relationships for 289 Pacific salmon stocks located throughout the Northeast Pacific region.


```{r load,  include=FALSE}
library(here);library(ggplot2);library(dplyr);library(cowplot);library(ggspatial);library(sf);library(rnaturalearth);library(rnaturalearthdata)
options(dplyr.summarise.inform = FALSE)
stock_dat<- read.csv(here('data','filtered datasets','salmon_productivity_compilation2023-11-20.csv'))
stock_dat$stock=gsub('/','_',stock_dat$stock)
stock_dat$stock=gsub('&','and',stock_dat$stock)
stock_info<- read.csv(here('data','filtered datasets','stock_info2023-11-20.csv'))
#Remove stocks with less than 15 years of recruitment data
stock_info_filtered=subset(stock_info,n.years>=15) #289 stocks
stock_info_filtered$stock.name=gsub('/','_',stock_info_filtered$stock.name)
stock_info_filtered$stock.name=gsub('&','and',stock_info_filtered$stock.name)

stock_info_filtered$state=factor(stock_info_filtered$state,levels=c('OR','WA','BC','AK'))
stock_info_filtered$ocean.basin=factor(stock_info_filtered$ocean.basin,levels=c('WC','GOA','BS'))

stock_dat2=subset(stock_dat,stock.id %in% stock_info_filtered$stock.id)
length(unique(stock_dat2$stock)) #267

stock_dat2$logR_S=log(stock_dat2$recruits/stock_dat2$spawners)

stock_info_filtered$state2=as.character(stock_info_filtered$state)
stock_info_filtered=stock_info_filtered %>% mutate(state2=ifelse(state=='OR','OR-WA',state2),
                                                   state2=ifelse(state=='WA','OR-WA',state2))
rownames(stock_info_filtered)=seq(1:nrow(stock_info_filtered))
stock_info_filtered$species2=gsub("-.*", "", stock_info_filtered$species) # collapse even/odd pinks


move_avg_mat<- function(x, lag = 2) {             # Create user-defined function
  m=NA
  se=NA
  for(t in c(lag+1):c(ncol(x)-lag)){
   x1=x[,c(t-lag):c(t+lag)] 
   m[t]=mean(as.vector(na.omit(x1)))
   se[t]=sd(as.vector(na.omit(x1)))/sqrt(length(as.vector(na.omit(x1))))
  }
  return(data.frame(m,se))
}


```

```{r, plot colour schemes}
sp_cols=cbind(c('#6f9ba7',
'#316024',
'#295f8b',
'#a2450c',
'#811b0a'),c('Chinook','Chum','Coho','Pink','Sockeye'))

basin_cols=cbind(c('#016c59',
                  '#1c9099',
                  '#67a9cf')
                ,c('WC','GOA','BS'))

state_cols=cbind(c('#edf8b1',
                  '#1c9099',
                  '#67a9cf')
                ,c('OR-WA','BC','AK'))

mytheme = list(
  theme_classic(14)+
    theme(panel.background = element_blank(),strip.background = element_rect(colour=NA, fill=NA),panel.border = element_rect(fill = NA, color = "black"),
          legend.title = element_blank(),legend.position="bottom", strip.text = element_text(face="bold", size=13),
          axis.text=element_text(face="bold"),axis.title = element_text(face="bold",size=16),plot.title = element_text(face = "bold", hjust = 0.5,size=16))
)

```



## Map of timeseries
```{r, ts map,warning= FALSE,fig.dim = c(8, 6)}
world <- ne_countries(scale = "medium", returnclass = "sf")

all_lat_lon = stock_info_filtered %>% group_by(lat,lon,species2) %>% summarize(n=n(),.groups = 'keep')
all_lat_lon$lon=ifelse(all_lat_lon$lon>0,-all_lat_lon$lon,all_lat_lon$lon)
ll_p=subset(all_lat_lon,species2=='Pink')
ll_ch=subset(all_lat_lon,species2=='Chum')
ll_soc=subset(all_lat_lon,species2=='Sockeye')
ll_coh=subset(all_lat_lon,species2=='Coho')
ll_chi=subset(all_lat_lon,species2=='Chinook')

ggplot(data = world) + 
  geom_sf(fill= 'antiquewhite') +  xlab("Longitude") + ylab("Latitude") +
  geom_point(data = ll_p, mapping = aes(x = lon, y = lat), color = sp_cols[4], size = 2.2*log(ll_p$n+1), alpha = 0.7) +
  geom_point(data = ll_ch, mapping = aes(x = lon, y = lat), color = sp_cols[2], size = 2.2*log(ll_ch$n+1), alpha = 0.7) +
  geom_point(data =  ll_soc, mapping = aes(x = lon, y = lat), color = sp_cols[5], size = 2.2*log(ll_soc$n+1), alpha = 0.7) +
  geom_point(data =  ll_coh, mapping = aes(x = lon, y = lat), color = sp_cols[3], size = 2.2*log(ll_coh$n+1), alpha = 0.7) +
  geom_point(data = ll_chi, mapping = aes(x = lon, y = lat), color = sp_cols[1], size = 2.2*log(ll_chi$n+1), alpha = 0.7) +
    annotate(geom = 'text', x = -155, y = 54.5, label = 'Chinook', color = sp_cols[1], size = 4.5) + 
  annotate(geom = 'text', x = -155, y = 53, label = 'Chum', color = sp_cols[2], size = 4.5) + 
  annotate(geom = 'text', x = -155, y = 51.5, label = 'Coho', color = sp_cols[3], size = 4.5) + 
  annotate(geom = 'text', x = -155, y = 50, label = 'Pink', color = sp_cols[4], size = 4.5) + 
  annotate(geom = 'text', x = -155, y = 48.5, label = 'Sockeye', color = sp_cols[5], size = 4.5) + 
  annotate(geom = 'point', x = -145, y = 54, size = 2.2*log(1+1)) +
  annotate(geom = 'point', x = -145, y = 53, size = 2.2*log(3+1)) + 
  annotate(geom = 'point', x = -145, y = 51.5, size = 2.2*log(10+1)) + 
  annotate(geom = 'point', x = -145, y = 50, size = 2.2*log(20+1)) + 
  annotate(geom = 'text', x = -142, y = 55,label='n', size = 3.5) +
  annotate(geom = 'text', x = -142, y = 54,label='1', size = 3.5) +
  annotate(geom = 'text', x = -142, y = 53,label='3', size = 3.5) + 
  annotate(geom = 'text', x = -142, y = 51.5,label='10', size = 3.5) + 
  annotate(geom = 'text', x = -142, y = 50,label='20', size = 3.5) + 
  annotation_scale(location = 'bl', width_hint = 0.5) + 
  annotation_north_arrow(location = 'bl', which_north = 'true', pad_x = unit(0.35, 'in'), pad_y = unit(0.25, 'in'), style = north_arrow_fancy_orienteering) + 
  coord_sf(xlim = c(-170, -120), ylim = c(47, 72), expand = T) +
theme(panel.grid.major = element_line(color = gray(.5), linetype = 'dashed', size = 0.1), panel.background = element_rect(fill = 'lightblue1'),legend.title = element_blank())

```

## States/Provinces

```{r, ts by state}
sp_sum<- stock_info_filtered %>% group_by(species2,state) %>% summarize(n=n(),.groups='keep')
sp_sum$state=factor(sp_sum$state,levels=c('OR','WA','BC','AK'))

ggplot(sp_sum, aes(fill=species2, y=n, x=state))+
scale_fill_manual(values=sp_cols[match(levels(factor(sp_sum$species2)),sp_cols[,2])])+ 
  geom_bar(position="stack", stat="identity") +
xlab('')+ylab('No. time-series')+
           mytheme
          

```

## Ocean basins

```{r, ts by ocean}
sp_sum<- stock_info_filtered %>% group_by(species2,ocean.basin) %>% summarize(n=n(),.groups='keep')

ggplot(sp_sum, aes(fill=species2, y=n, x=ocean.basin))+
scale_fill_manual(values=sp_cols[match(levels(factor(sp_sum$species2)),sp_cols[,2])])+ 
  geom_bar(position="stack", stat="identity") + theme_minimal() +
xlab('')+ylab('No. time-series')+
            theme(panel.background = element_blank(),strip.background = element_rect(colour=NA, fill=NA),panel.border = element_rect(fill = NA, color = "black"),
                  strip.text = element_text(face="bold", size=12),
                  axis.text=element_text(face="bold"),axis.title = element_text(face="bold"),plot.title = element_text(face = "bold", hjust = 0.5,size=15))

```

## Series length

```{r, ts length}
sp_sum<- stock_info_filtered %>% group_by(n.years,species2) %>% summarize(n=n(),.groups='keep')

ggplot(sp_sum, aes(fill=species2, y=n, x=n.years))+
scale_fill_manual(values=sp_cols[match(levels(factor(sp_sum$species2)),sp_cols[,2])])+ 
  geom_bar(position="stack", stat="identity") + theme_minimal() +
xlab('Years')+ylab('No. time-series')+
 mytheme

```



# Stock Characteristics

Here we include an overview of parameters estimated for each stock fit from the aforementioned models.

```{r, load model outputs}
pl1=list() #params list - m1
pl2=list() #params list - m2
pl3=list() #params list - m3
pl4=list() #params list - m4
pl5=list() #params list - m5
pl6=list() #params list - m6
pl7=list() #params list - m7


for(i in 1:nrow(stock_info_filtered)){
#  pl1[[i]]=read.csv(here('outputs','parameters',paste(sprintf("%03d", i),stock_info_filtered$stock.name[i],sep=''),'m1.csv'))  
  pl2[[i]]=read.csv(here('outputs','parameters',paste(sprintf("%03d", i),stock_info_filtered$stock.name[i],sep=''),'m2.csv'))  
  pl3[[i]]=read.csv(here('outputs','parameters',paste(sprintf("%03d", i),stock_info_filtered$stock.name[i],sep=''),'m3.csv'))  
 # pl4[[i]]=read.csv(here('outputs','parameters',paste(sprintf("%03d", i),stock_info_filtered$stock.name[i],sep=''),'m4.csv'))  
#  pl5[[i]]=read.csv(here('outputs','parameters',paste(sprintf("%03d", i),stock_info_filtered$stock.name[i],sep=''),'m5.csv'))  
#  pl6[[i]]=read.csv(here('outputs','parameters',paste(sprintf("%03d", i),stock_info_filtered$stock.name[i],sep=''),'m6.csv'))  
#  pl7[[i]]=read.csv(here('outputs','parameters',paste(sprintf("%03d", i),stock_info_filtered$stock.name[i],sep=''),'m7.csv'))  
}

```

## Productivity - log(alpha)

Log($\alpha$) estimated from the autocorrelated Ricker function (;model 2) for 267 Pacific salmon stocks. The light histogram is the entire posterior distribution among all stocks, while the dark histogram in the foreground indicates the distribution of median estimates among the 267 stocks:

```{r, stock char - log a}
m_alpha=unlist(lapply(pl2,function(x) median(x[,intersect(names(x), 'log_a')])))

d_alpha_l=lapply(pl2,function(x) x[,intersect(names(x), 'log_a')])
d_alpha=do.call('cbind',d_alpha_l)

par(mar=c(4,5,1,1))
hist(as.vector(d_alpha),col=adjustcolor('gray',alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.4),breaks=50,freq=T,main='',xlab=expression(paste('log(',alpha,')')),yaxt='n',ylab='')

par(new=T)
hist(m_alpha,col=adjustcolor('black',alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,50),main='',xlab='')
ticksat <- seq(-1,4,by=0.1)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
ticksat <- seq(-1,4,by=0.2)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.5, lwd=0, lwd.ticks=1)
```
Summary of the median estimate of log($\alpha$) among all stocks:

```{r}
summary(as.vector(m_alpha))
```


Log($\alpha$) estimated from the autocorrelated Ricker function (model 2) broken down by species:

```{r, stock char - log a by species}
par(mar = c(3, 2, 1, 1))
chi_alpha=d_alpha[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook',]))]
chu_alpha=d_alpha[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum',]))]
coh_alpha=d_alpha[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho',]))]
pi_alpha1=d_alpha[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Pink-Even',]))]
pi_alpha2=d_alpha[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Pink-odd',]))]
pi_alpha=cbind(pi_alpha1,pi_alpha2)
soc_alpha=d_alpha[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye',]))]

par(mfrow=c(5,1))
hist(as.vector(chi_alpha),col=adjustcolor(sp_cols[1],alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='n')
text(3.5,par('usr')[4]*0.9,'Chinook',col=sp_cols[1],cex=1.8)
par(new=T)
m_alpha=apply(chi_alpha,2,median)
hist(m_alpha,col=adjustcolor('black',alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
ticksat <- seq(-1,4,by=0.1)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
ticksat <- seq(-1,4,by=0.2)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.5, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(chu_alpha),col=adjustcolor(sp_cols[2],alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=50,freq=F,main='',xlab='',yaxt='n',ylab='n')
text(3.5,par('usr')[4]*0.9,'Chum',col=sp_cols[2],cex=1.8)
par(new=T)
m_alpha=apply(chu_alpha,2,median)
hist(m_alpha,col=adjustcolor('black',alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,10),main='',xlab='')
ticksat <- seq(-1,4,by=0.1)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
ticksat <- seq(-1,4,by=0.2)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.5, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(coh_alpha),col=adjustcolor(sp_cols[3],alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=50,freq=F,main='',xlab='',yaxt='n',ylab='n')
text(3.5,par('usr')[4]*0.9,'Coho',col=sp_cols[3],cex=1.8)
par(new=T)
m_alpha=apply(coh_alpha,2,median)
hist(m_alpha,col=adjustcolor('black',alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,10),main='',xlab='')
ticksat <- seq(-1,4,by=0.1)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
ticksat <- seq(-1,4,by=0.2)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.5, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(pi_alpha),col=adjustcolor(sp_cols[4],alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=50,freq=F,main='',xlab='',yaxt='n',ylab='n')
text(3.5,par('usr')[4]*0.9,'Pink',col=sp_cols[4],cex=1.8)
par(new=T)
m_alpha=apply(pi_alpha,2,median)
hist(m_alpha,col=adjustcolor('black',alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,10),main='',xlab='')
ticksat <- seq(-1,4,by=0.1)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
ticksat <- seq(-1,4,by=0.2)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.5, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(soc_alpha),col=adjustcolor(sp_cols[5],alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=50,freq=F,main='',xlab='',yaxt='n',ylab='n')
text(3.5,par('usr')[4]*0.9,'Sockeye',col=sp_cols[5],cex=1.3)
par(new=T)
m_alpha=apply(soc_alpha,2,median)
hist(m_alpha,col=adjustcolor('black',alpha=0.4),xlim=c(min(d_alpha),max(d_alpha)),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
mtext(expression(paste('log(',alpha,')')),side=1,line=2)
ticksat <- seq(-1,4,by=0.1)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
ticksat <- seq(-1,4,by=0.2)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.5, lwd=0, lwd.ticks=1)
```

## Capacity - Smax

$Smax$ (1/beta) estimated from the simple Ricker function (model 2) for 267 Pacific salmon stocks:

```{r, stock char - Smax, fig.dim = c(8, 6)}
m_smax=unlist(lapply(pl2,function(x) median(x[,intersect(names(x), 'Smax')])))

d_smax_l=lapply(pl2,function(x) x[,intersect(names(x), 'Smax')])
d_smax=do.call('cbind',d_smax_l)

par(mfrow=c(1,1))
par(mar=c(4,5,1,1))
hist(as.vector(log10(d_smax)),col=adjustcolor('gray',alpha=0.4),border=adjustcolor('white',alpha=0.4),breaks=50,freq=T,main='',xlim=c(min(as.vector(log10(d_smax))),max(as.vector(log10(d_smax)))),yaxt='n',ylab='',xaxt='n',xlab='Smax')

par(new=T)
hist(log10(m_smax),col=adjustcolor('black',alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,50),main='',xaxt='n',xlab='')
pow <- 0:7
ticksat <- as.vector(sapply(pow, function(p) (1:10)*10^p))
axis(1, log10(ticksat), col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

axis(1, col="black", at=seq(0,8,by=1),   tcl=-0.45, cex.axis=1.2,
     labels=c(expression(1),expression(10),expression(100),expression('1K'),expression('10K'),expression('100K'),expression('1M'),expression('10M'),expression('100M')))

```

Smax (1/beta) estimated from the simple Ricker function (model 1) broken down by species:

```{r, stock char - Smax by species, fig.dim = c(14, 10)}
chi_smax=d_smax[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook',]))]
chu_smax=d_smax[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum',]))]
coh_smax=d_smax[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho',]))]
pi_smax1=d_smax[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Pink-Even',]))]
pi_smax2=d_smax[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Pink-odd',]))]
pi_smax=cbind(pi_smax1,pi_smax2)
soc_smax=d_smax[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye',]))]

par(mar = c(3, 2, 1, 1))
#par(mfrow=c(5,1))
hist(log10(as.vector(chi_smax)),col=adjustcolor(sp_cols[1],alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='n',xaxt='n')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Chinook',col=sp_cols[1],cex=1.3)
par(new=T)
m_smax=apply(chi_smax,2,median)
hist(log10(m_smax),col=adjustcolor('black',alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='',xaxt='n')
pow <- 0:7
ticksat <- as.vector(sapply(pow, function(p) (1:10)*10^p))
axis(1, log10(ticksat), col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

axis(1, col="black", at=seq(0,8,by=1),   tcl=-0.45, cex.axis=1.2,
     labels=c(expression(1),expression(10),expression(100),expression('1K'),expression('10K'),expression('100K'),expression('1M'),expression('10M'),expression('100M')))

#par(new=T)
hist(log10(as.vector(chu_smax)),col=adjustcolor(sp_cols[2],alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='n',xaxt='n')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Chum',col=sp_cols[2],cex=1.3)
par(new=T)
m_smax=apply(chu_smax,2,median)
hist(log10(m_smax),col=adjustcolor('black',alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='',xaxt='n')
pow <- 0:7
ticksat <- as.vector(sapply(pow, function(p) (1:10)*10^p))
axis(1, log10(ticksat), col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

axis(1, col="black", at=seq(0,8,by=1),   tcl=-0.45, cex.axis=1.2,
     labels=c(expression(1),expression(10),expression(100),expression('1K'),expression('10K'),expression('100K'),expression('1M'),expression('10M'),expression('100M')))

#par(new=T)
hist(log10(as.vector(coh_smax)),col=adjustcolor(sp_cols[3],alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='n',xaxt='n')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Coho',col=sp_cols[3],cex=1.3)
par(new=T)
m_smax=apply(coh_smax,2,median)
hist(log10(m_smax),col=adjustcolor('black',alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='',xaxt='n')
pow <- 0:7
ticksat <- as.vector(sapply(pow, function(p) (1:10)*10^p))
axis(1, log10(ticksat), col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

axis(1, col="black", at=seq(0,8,by=1),   tcl=-0.45, cex.axis=1.2,
     labels=c(expression(1),expression(10),expression(100),expression('1K'),expression('10K'),expression('100K'),expression('1M'),expression('10M'),expression('100M')))

#par(new=T)
hist(log10(as.vector(pi_smax)),col=adjustcolor(sp_cols[4],alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='n',xaxt='n')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Pink',col=sp_cols[4],cex=1.3)
par(new=T)
m_smax=apply(pi_smax,2,median)
hist(log10(m_smax),col=adjustcolor('black',alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='',xaxt='n')
pow <- 0:7
ticksat <- as.vector(sapply(pow, function(p) (1:10)*10^p))
axis(1, log10(ticksat), col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

axis(1, col="black", at=seq(0,8,by=1),   tcl=-0.45, cex.axis=1.2,
     labels=c(expression(1),expression(10),expression(100),expression('1K'),expression('10K'),expression('100K'),expression('1M'),expression('10M'),expression('100M')))
#par(new=T)
hist(log10(as.vector(soc_smax)),col=adjustcolor(sp_cols[5],alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='n',xaxt='n')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Sockeye',col=sp_cols[5],cex=1.3)
par(new=T)
m_smax=apply(soc_smax,2,median)
hist(log10(m_smax),col=adjustcolor('black',alpha=0.4),xlim=c(min(log10(d_smax)),max(log10(d_smax))),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='',xaxt='n')
pow <- 0:7
ticksat <- as.vector(sapply(pow, function(p) (1:10)*10^p))
axis(1, log10(ticksat), col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

axis(1, col="black", at=seq(0,8,by=1),   tcl=-0.45, cex.axis=1.2,
     labels=c(expression(1),expression(10),expression(100),expression('1K'),expression('10K'),expression('100K'),expression('1M'),expression('10M'),expression('100M')))

mtext('Smax',side=1,line=2)
```

## Sigma

$\sigma$ (residual deviance) estimated from the simple Ricker function (model 1) for 267 Pacific salmon stocks:

```{r, stock char - sigma}
m_sigma=unlist(lapply(pl2,function(x) median(x[,intersect(names(x), 'sigma_AR')])))

d_sigma_l=lapply(pl2,function(x) x[,intersect(names(x), 'sigma_AR')])
d_sigma=do.call('cbind',d_sigma_l)

par(mfrow=c(1,1))
par(mar=c(4,5,1,1))
hist(as.vector(d_sigma),col=adjustcolor('gray',alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.4),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')

par(new=T)
hist(m_sigma,col=adjustcolor('black',alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,50),main='',xlab=expression(paste(sigma)),xaxt='n',ylab='')
ticksat <- seq(0,2.5,by=0.1)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

summary(as.vector(m_sigma))
```

$\sigma$ (residual deviance) broken down by species:

```{r, stock char - sigma by species, warnings=FALSE}
chi_sigma=d_sigma[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook',]))]
chu_sigma=d_sigma[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum',]))]
coh_sigma=d_sigma[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho',]))]
pi_sigma1=d_sigma[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Pink-Even',]))]
pi_sigma2=d_sigma[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Pink-odd',]))]
pi_sigma=cbind(pi_sigma1,pi_sigma2)
soc_sigma=d_sigma[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye',]))]


par(mar = c(3, 2, 1, 1))
hist(as.vector(chi_sigma),col=adjustcolor(sp_cols[1],alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Chinook',col=sp_cols[1],cex=1.3)
par(new=T)
m_sig=apply(chi_sigma,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(chu_sigma),col=adjustcolor(sp_cols[2],alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Chum',col=sp_cols[2],cex=1.3)
par(new=T)
m_sig=apply(chu_sigma,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(coh_sigma),col=adjustcolor(sp_cols[3],alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Coho',col=sp_cols[3],cex=1.3)
par(new=T)
m_sig=apply(coh_sigma,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(pi_sigma),col=adjustcolor(sp_cols[4],alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Pink',col=sp_cols[4],cex=1.3)
par(new=T)
m_sig=apply(pi_sigma,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(soc_sigma),col=adjustcolor(sp_cols[5],alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Sockeye',col=sp_cols[5],cex=1.3)
par(new=T)
m_sig=apply(soc_sigma,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(0,2.5),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

mtext(expression(paste(sigma)),side=1,line=2,cex=1.4)
```

## Autocorrelation (Rho)


$\rho$, autocorrelation coefficient for residuals from the Ricker function (model 2) for 267 Pacific salmon stocks:

```{r, stock char - rho, warnings=FALSE}
m_rho=unlist(lapply(pl2,function(x) median(x[,intersect(names(x), 'rho')])))

d_rho_l=lapply(pl2,function(x) x[,intersect(names(x), 'rho')])
d_rho=do.call('cbind',d_rho_l)

par(mfrow=c(1,1))
par(mar=c(4,5,1,1))
hist(as.vector(d_rho),col=adjustcolor('gray',alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.4),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')

par(new=T)
hist(m_rho,col=adjustcolor('black',alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,100),main='',xlab='',xaxt='n',ylab='')
ticksat <- seq(0,2.5,by=0.1)
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

mtext(expression(paste(rho)),side=1,line=2.2,cex=1.4)
```

$\rho$, autocorrelation broken down by species:

```{r, stock char - rho by species, warnings=FALSE}
chi_rho=d_rho[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook',]))]
chu_rho=d_rho[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum',]))]
coh_rho=d_rho[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho',]))]
pi_rho1=d_rho[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Pink-Even',]))]
pi_rho2=d_rho[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Pink-odd',]))]
pi_rho=cbind(pi_rho1,pi_rho2)
soc_rho=d_rho[,as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye',]))]

par(mfrow=c(5,1))
par(mar = c(3, 2, 1, 1))
hist(as.vector(chi_rho),col=adjustcolor(sp_cols[1],alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Chinook',col=sp_cols[1],cex=1.3)
par(new=T)
m_sig=apply(chi_rho,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(chu_rho),col=adjustcolor(sp_cols[2],alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Chum',col=sp_cols[2],cex=1.3)
par(new=T)
m_sig=apply(chu_rho,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(coh_rho),col=adjustcolor(sp_cols[3],alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Coho',col=sp_cols[3],cex=1.3)
par(new=T)
m_sig=apply(coh_rho,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(pi_rho),col=adjustcolor(sp_cols[4],alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Pink',col=sp_cols[4],cex=1.3)
par(new=T)
m_sig=apply(pi_rho,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=20,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)
#par(new=T)
hist(as.vector(soc_rho),col=adjustcolor(sp_cols[5],alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=50,freq=T,main='',xlab='',yaxt='n',ylab='')
text(par('usr')[2]*0.8,par('usr')[4]*0.9,'Sockeye',col=sp_cols[5],cex=1.3)
par(new=T)
m_sig=apply(soc_rho,2,median)
hist(m_sig,col=adjustcolor('black',alpha=0.4),xlim=c(-1,1),border=adjustcolor('white',alpha=0.2),breaks=30,freq=T,ylim=c(0,20),main='',xlab='')
axis(1, ticksat, col="black", labels=NA,
     tcl=-0.2, lwd=0, lwd.ticks=1)

mtext(expression(paste(rho)),side=1,line=2.2,cex=1.2)
```

# Productivity trends

## All stocks
Time-varying productivity trajectories for each stock, with a 5-year moving average and 95% credible intervals around the average.

```{r, prod trends}
prod_matr=matrix(nrow=nrow(stock_info_filtered),ncol=max(stock_dat2$broodyear)-min(stock_dat2$broodyear)+1)
colnames(prod_matr)=seq(min(stock_dat2$broodyear),max(stock_dat2$broodyear))
prod_matr2=matrix(nrow=nrow(stock_info_filtered),ncol=max(stock_dat2$broodyear)-min(stock_dat2$broodyear)+1)
colnames(prod_matr2)=seq(min(stock_dat2$broodyear),max(stock_dat2$broodyear))
umsy_matr=matrix(nrow=nrow(stock_info_filtered),ncol=max(stock_dat2$broodyear)-min(stock_dat2$broodyear)+1)
colnames(umsy_matr)=seq(min(stock_dat2$broodyear),max(stock_dat2$broodyear))
umsy_matr2=matrix(nrow=nrow(stock_info_filtered),ncol=max(stock_dat2$broodyear)-min(stock_dat2$broodyear)+1)
colnames(umsy_matr2)=seq(min(stock_dat2$broodyear),max(stock_dat2$broodyear))

for(i in 1:nrow(stock_info_filtered)){
  s<- subset(stock_dat2,stock==stock_info_filtered$stock.name[i])
  s<- s[complete.cases(s$logR_S),] 
  
  df=data.frame(S=s$spawners,R=s$recruits,by=s$broodyear,logRS=s$logR_S)
  
  prod=pl3[[i]][,grepl('log_a',colnames(pl3[[i]]))]
  prod_m=apply(prod,2,median)
  prod_scale=prod-median(unlist(prod))
  prod_m_scale=apply(prod_scale,2,median) #scaled as multiplier of median
  
  prod_matr[i,match(seq(min(df$by),max(df$by)),colnames(prod_matr))]=prod_m
  prod_matr2[i,match(seq(min(df$by),max(df$by)),colnames(prod_matr2))]=prod_m_scale
  
  umsy=pl3[[i]][,grepl('Umsy',colnames(pl3[[i]]))]
  umsy_m=apply(umsy,2,median)
  umsy_scale=umsy-median(unlist(umsy))
  umsy_m_scale=apply(umsy_scale,2,median) #scaled as multiplier of median
  
  umsy_matr[i,match(seq(min(df$by),max(df$by)),colnames(umsy_matr))]=umsy_m
  umsy_matr2[i,match(seq(min(df$by),max(df$by)),colnames(umsy_matr2))]=umsy_m_scale
}

```

### Productivity
```{r, prod glob x}
plot(rep(0,ncol(prod_matr))~colnames(prod_matr),ylim=c(-2,5),ylab=expression(paste('Productivity, ',log(alpha))),type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(prod_matr)){
  lines(prod_matr[i,]~colnames(prod_matr),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(prod_matr);m.prod.5f$y=colnames(prod_matr)[1:c(ncol(prod_matr)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor('navy', alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col='navy')

```


#### ocean region
```{r, all or}
alpha_wc=subset(prod_matr,stock_info_filtered$ocean.basin=='WC')
alpha_goa=subset(prod_matr,stock_info_filtered$ocean.basin=='GOA')
alpha_bs=subset(prod_matr,stock_info_filtered$ocean.basin=='BS')

par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(alpha_wc))~colnames(alpha_wc),ylim=c(0,25),ylab=expression(paste('Productivity, ',log(alpha)))
,type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(alpha_wc)){
  lines(exp(alpha_wc)[i,]~colnames(alpha_wc),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(alpha_wc));m.prod.5f$y=colnames(alpha_wc)[1:c(ncol(alpha_wc)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(alpha_goa)){
  lines(exp(alpha_goa)[i,]~colnames(alpha_wc),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(alpha_goa));m.prod.5f$y=colnames(alpha_wc)[1:c(ncol(alpha_wc)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(alpha_bs)){
  lines(exp(alpha_bs)[i,]~colnames(alpha_wc),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(alpha_bs));m.prod.5f$y=colnames(alpha_wc)[1:c(ncol(alpha_wc)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, all st}

alpha_ak=subset(prod_matr,stock_info_filtered$state2=='AK')
alpha_bc=subset(prod_matr,stock_info_filtered$state2=='BC')
alpha_orwa=subset(prod_matr,stock_info_filtered$state2=='OR-WA')

par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(alpha_orwa))~colnames(alpha_orwa),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(alpha_orwa)){
  lines(exp(alpha_orwa)[i,]~colnames(alpha_orwa),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(alpha_orwa));m.prod.5f$y=colnames(alpha_orwa)[1:c(ncol(alpha_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(alpha_bc)){
  lines(exp(alpha_bc)[i,]~colnames(alpha_orwa),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(alpha_bc));m.prod.5f$y=colnames(alpha_orwa)[1:c(ncol(alpha_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(alpha_ak)){
  lines(exp(alpha_ak)[i,]~colnames(alpha_orwa),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(alpha_ak));m.prod.5f$y=colnames(alpha_orwa)[1:c(ncol(alpha_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Productivity
```{r, plot scale prod all}
plot(rep(0,ncol(prod_matr2))~colnames(prod_matr2),ylim=c(-3,3),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(prod_matr2)){
  lines(prod_matr2[i,]~colnames(prod_matr2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(prod_matr2);m.prod.5f$y=colnames(prod_matr)[1:c(ncol(prod_matr)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor('navy', alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col='navy')

```

#### ocean region
```{r, all or sc}
alpha_wc=subset(prod_matr2,stock_info_filtered$ocean.basin=='WC')
alpha_goa=subset(prod_matr2,stock_info_filtered$ocean.basin=='GOA')
alpha_bs=subset(prod_matr2,stock_info_filtered$ocean.basin=='BS')

par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(prod_matr2))~colnames(prod_matr2),ylim=c(-3,3),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
abline(h=0)
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(alpha_wc)){
  lines(alpha_wc[i,]~colnames(alpha_wc),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(alpha_wc);m.prod.5f$y=colnames(alpha_wc)[1:c(ncol(alpha_wc)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(alpha_goa)){
  lines(alpha_goa[i,]~colnames(alpha_wc),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(alpha_goa);m.prod.5f$y=colnames(alpha_wc)[1:c(ncol(alpha_wc)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(alpha_bs)){
  lines(alpha_bs[i,]~colnames(alpha_wc),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(alpha_bs);m.prod.5f$y=colnames(alpha_wc)[1:c(ncol(alpha_wc)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, all st sc}

alpha_ak=subset(prod_matr2,stock_info_filtered$state2=='AK')
alpha_bc=subset(prod_matr2,stock_info_filtered$state2=='BC')
alpha_orwa=subset(prod_matr2,stock_info_filtered$state2=='OR-WA')

par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(prod_matr2))~colnames(prod_matr2),ylim=c(-3,3),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
abline(h=0)
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(alpha_orwa)){
  lines(alpha_orwa[i,]~colnames(alpha_orwa),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(alpha_orwa);m.prod.5f$y=colnames(alpha_orwa)[1:c(ncol(alpha_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(alpha_bc)){
  lines(alpha_bc[i,]~colnames(alpha_orwa),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(alpha_bc);m.prod.5f$y=colnames(alpha_orwa)[1:c(ncol(alpha_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(alpha_ak)){
  lines(alpha_ak[i,]~colnames(alpha_orwa),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(alpha_ak);m.prod.5f$y=colnames(alpha_orwa)[1:c(ncol(alpha_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Umsy
```{r, plot prod umsy all}
plot(rep(0,ncol(umsy_matr))~colnames(umsy_matr),ylim=c(0,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(umsy_matr)){
  lines(umsy_matr[i,]~colnames(umsy_matr),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.umsy.5f=move_avg_mat(umsy_matr);m.umsy.5f$y=colnames(umsy_matr)[1:c(ncol(umsy_matr)-2)]
m.umsy.5f=m.umsy.5f[complete.cases(m.umsy.5f[,1]),]
x<- c(seq(m.umsy.5f$y[1],m.umsy.5f$y[nrow(m.umsy.5f)]), rev(seq(m.umsy.5f$y[1],m.umsy.5f$y[nrow(m.umsy.5f)])))
y<- c(m.umsy.5f[,1]-2*m.umsy.5f[,2], rev(m.umsy.5f[,1]+2*m.umsy.5f[,2]))
polygon(x, y, col = adjustcolor('navy', alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.umsy.5f[,1]~seq(min(x),max(x)),lwd=2,col='navy')


```

#### ocean region
```{r, all u or}
umsy_wc=subset(umsy_matr,stock_info_filtered$ocean.basin=='WC')
umsy_goa=subset(umsy_matr,stock_info_filtered$ocean.basin=='GOA')
umsy_bs=subset(umsy_matr,stock_info_filtered$ocean.basin=='BS')

par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(umsy_wc))~colnames(umsy_wc),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))

for(i in 1:nrow(umsy_wc)){
   lines(umsy_wc[i,]~colnames(umsy_wc),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_wc);m.prod.5f$y=colnames(umsy_bs)[1:c(ncol(umsy_bs)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(umsy_goa)){
  lines(umsy_goa[i,]~colnames(umsy_goa),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_goa);m.prod.5f$y=colnames(umsy_bs)[1:c(ncol(umsy_bs)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(umsy_bs)){
  lines(umsy_bs[i,]~colnames(umsy_bs),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_bs);m.prod.5f$y=colnames(umsy_bs)[1:c(ncol(umsy_bs)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, all u st}
umsy_orwa=subset(umsy_matr,stock_info_filtered$state2=='OR-WA')
umsy_bc=subset(umsy_matr,stock_info_filtered$state=='BC')
umsy_ak=subset(umsy_matr,stock_info_filtered$state=='AK')

par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(umsy_orwa))~colnames(umsy_ak),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')

axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(umsy_orwa)){
  lines(umsy_orwa[i,]~colnames(umsy_orwa),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_orwa);m.prod.5f$y=colnames(umsy_orwa)[1:c(ncol(umsy_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(umsy_bc)){
  lines(umsy_bc[i,]~colnames(umsy_bc),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_bc);m.prod.5f$y=colnames(umsy_orwa)[1:c(ncol(umsy_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(umsy_ak)){
  lines(umsy_ak[i,]~colnames(umsy_ak),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_ak);m.prod.5f$y=colnames(umsy_ak)[1:c(ncol(umsy_ak)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Umsy
```{r, plot prod sc umsy}
plot(rep(0,ncol(umsy_matr2))~colnames(umsy_matr2),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(umsy_matr2)){
  lines(umsy_matr2[i,]~colnames(umsy_matr2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.umsy.5f=move_avg_mat(umsy_matr2);m.umsy.5f$y=colnames(umsy_matr)[1:c(ncol(umsy_matr)-2)]
m.umsy.5f=m.umsy.5f[complete.cases(m.umsy.5f[,1]),]
x<- c(seq(m.umsy.5f$y[1],m.umsy.5f$y[nrow(m.umsy.5f)]), rev(seq(m.umsy.5f$y[1],m.umsy.5f$y[nrow(m.umsy.5f)])))
y<- c(m.umsy.5f[,1]-2*m.umsy.5f[,2], rev(m.umsy.5f[,1]+2*m.umsy.5f[,2]))
polygon(x, y, col = adjustcolor('navy', alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.umsy.5f[,1]~seq(min(x),max(x)),lwd=2,col='navy')

```

#### ocean region
```{r, all us or}
umsy_wc=subset(umsy_matr2,stock_info_filtered$ocean.basin=='WC')
umsy_goa=subset(umsy_matr2,stock_info_filtered$ocean.basin=='GOA')
umsy_bs=subset(umsy_matr2,stock_info_filtered$ocean.basin=='BS')

par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(umsy_matr2))~colnames(umsy_matr2),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
abline(h=0)
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(umsy_wc)){
   lines(umsy_wc[i,]~colnames(umsy_wc),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_wc);m.prod.5f$y=colnames(umsy_bs)[1:c(ncol(umsy_bs)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(umsy_goa)){
  lines(umsy_goa[i,]~colnames(umsy_goa),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_goa);m.prod.5f$y=colnames(umsy_bs)[1:c(ncol(umsy_bs)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(umsy_bs)){
  lines(umsy_bs[i,]~colnames(umsy_bs),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_bs);m.prod.5f$y=colnames(umsy_bs)[1:c(ncol(umsy_bs)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, all us st}
umsy_orwa=subset(umsy_matr2,stock_info_filtered$state2=='OR-WA')
umsy_bc=subset(umsy_matr2,stock_info_filtered$state=='BC')
umsy_ak=subset(umsy_matr2,stock_info_filtered$state=='AK')

par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(umsy_matr2))~colnames(umsy_matr2),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
abline(h=0)
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(umsy_orwa)){
  lines(umsy_orwa[i,]~colnames(umsy_orwa),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_orwa);m.prod.5f$y=colnames(umsy_orwa)[1:c(ncol(umsy_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(umsy_bc)){
  lines(umsy_bc[i,]~colnames(umsy_bc),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_bc);m.prod.5f$y=colnames(umsy_orwa)[1:c(ncol(umsy_orwa)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(umsy_ak)){
  lines(umsy_ak[i,]~colnames(umsy_ak),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(umsy_ak);m.prod.5f$y=colnames(umsy_ak)[1:c(ncol(umsy_ak)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Change in productivity
```{r, recent prod mat}
lt_prod=data.frame(stock=stock_info_filtered$stock.name,alpha=NA,a.l95=NA,a.u95=NA,umsy=NA,u.l95=NA,u.u95=NA,r.alpha=NA,r.a.l95=NA,r.a.u95=NA,r.umsy=NA,r.u.l95=NA,r.u.u95=NA)
for(i in 1:nrow(lt_prod)){
  alpha_t=pl3[[i]][,grepl('log_a',colnames(pl3[[i]]))]
  umsy_t=pl3[[i]][,grepl('Umsy',colnames(pl3[[i]]))]

  lt_prod[i,2]=median(pl2[[i]]$log_a)
  lt_prod[i,3]=quantile(pl2[[i]]$log_a,0.1)
  lt_prod[i,4]=quantile(pl2[[i]]$log_a,0.9)
  lt_prod[i,5]=median(pl2[[i]]$Umsy)
  lt_prod[i,6]=quantile(pl2[[i]]$Umsy,0.1)
  lt_prod[i,7]=quantile(pl2[[i]]$Umsy,0.9)
  lt_prod[i,8]=median(apply(alpha_t[,c(ncol(alpha_t)-9):ncol(alpha_t)],1,mean))
  lt_prod[i,9]=quantile(apply(alpha_t[,c(ncol(alpha_t)-9):ncol(alpha_t)],1,mean),0.1)
  lt_prod[i,10]=quantile(apply(alpha_t[,c(ncol(alpha_t)-9):ncol(alpha_t)],1,mean),0.9)
  lt_prod[i,11]=median(apply(umsy_t[,c(ncol(umsy_t)-9):ncol(umsy_t)],1,mean))
  lt_prod[i,12]=quantile(apply(umsy_t[,c(ncol(umsy_t)-9):ncol(umsy_t)],1,mean),0.1)
  lt_prod[i,13]=quantile(apply(umsy_t[,c(ncol(umsy_t)-9):ncol(umsy_t)],1,mean),0.9)
  }

lt_prod_chi=subset(lt_prod,stock_info_filtered$species=='Chinook')
lt_prod_chu=subset(lt_prod,stock_info_filtered$species=='Chum')
lt_prod_coh=subset(lt_prod,stock_info_filtered$species=='Coho')
lt_prod_pi=subset(lt_prod,stock_info_filtered$species2=='Pink')
lt_prod_soc=subset(lt_prod,stock_info_filtered$species=='Sockeye')

p_cols1=RColorBrewer::brewer.pal(n=10,name='RdYlBu')
p_change=exp(lt_prod$r.alpha)/exp(lt_prod$alpha)-1
cuts=cut(p_change, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]
breaks=hist(p_change,breaks=30,plot=FALSE)$breaks
```

```{r, recent prod comp}
par(mfrow=c(1,2))
plot(r.alpha~alpha,data=lt_prod,ylab=expression(paste('Recent (last 10y) log ',alpha,sep='  ')),xlab=expression(paste('Long-term average log ',alpha,sep='  ')),bty='l',type='n',xlim=c(-1.5,3.5),ylim=c(-1.5,3.5))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(alpha[i],r.alpha[i])~rep(alpha[i],2),col=p_cols2[i],data=lt_prod)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
points(r.alpha~alpha,data=lt_prod,bg=adjustcolor(p_cols2,alpha.f=0.2),col=adjustcolor(p_cols2,alpha.f=0.8),pch=21,cex=1.15)

break_cols=p_cols1[cut(as.numeric(breaks),breaks = c(seq(-1,1,length.out=10),3.5))]

hist(p_change,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','-0.5','','0','','0.5','','1','','1,5','','2','','2.5','','3'))

summary(p_change)

```

### Change in productivity

```{r, recent umsy}
lt_prod$r.umsy=ifelse(lt_prod$r.umsy<0,0.001,lt_prod$r.umsy)
p_change2=(lt_prod$r.umsy)/(lt_prod$umsy)-1
breaks=hist(p_change2,breaks=30,plot=FALSE)$breaks
cuts=cut(p_change2, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]


par(mfrow=c(1,2))
plot(r.umsy~umsy,data=lt_prod,ylab=expression('Recent (last 10y) U'[msy]),xlab=expression('Long-term average U'[msy]),bty='l',type='n',xlim=c(0,1),ylim=c(0,1))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(r.umsy[i],umsy[i])~rep(umsy[i],2),col=p_cols2[i],data=lt_prod)
}
points(r.umsy~umsy,data=lt_prod,bg=adjustcolor(p_cols2,alpha.f=0.2),col=adjustcolor(p_cols2,alpha.f=0.8),pch=21,cex=1)


hist(p_change2,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','','','0','','','','1','','','','2','','','','3'))
```


```{r, prod trends sp}
chi_alpha=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook',])),]
chi_alpha_goa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='GOA',])),]
chi_alpha_bs=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='BS',])),]
chi_alpha_wc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='WC',])),]
chi_alpha_ak=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='AK',])),]
chi_alpha_bc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='BC',])),]
chi_alpha_orwa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='OR-WA',])),]

chu_alpha=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum',])),]
chu_alpha_goa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='GOA',])),]
chu_alpha_bs=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='BS',])),]
chu_alpha_wc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='WC',])),]
chu_alpha_ak=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='AK',])),]
chu_alpha_bc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='BC',])),]
chu_alpha_orwa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='OR-WA',])),]

coh_alpha=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho',])),]
coh_alpha_goa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='GOA',])),]
coh_alpha_bs=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='BS',])),]
coh_alpha_wc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='WC',])),]
coh_alpha_ak=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='AK',])),]
coh_alpha_bc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='BC',])),]
coh_alpha_orwa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='OR-WA',])),]

pi_alpha=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink',])),]
pi_alpha_goa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='GOA',])),]
pi_alpha_bs=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='BS',])),]
pi_alpha_wc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='WC',])),]
pi_alpha_ak=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='AK',])),]
pi_alpha_bc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='BC',])),]
pi_alpha_orwa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='OR-WA',])),]

soc_alpha=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Sockeye',])),]
soc_alpha_goa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='GOA',])),]
soc_alpha_bs=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='BS',])),]
soc_alpha_wc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='WC',])),]
soc_alpha_ak=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='AK',])),]
soc_alpha_bc=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='BC',])),]
soc_alpha_orwa=prod_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='OR-WA',])),]

#prod scaled matrices
chi_alpha2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook',])),]
chi_alpha_goa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='GOA',])),]
chi_alpha_bs2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='BS',])),]
chi_alpha_wc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='WC',])),]
chi_alpha_ak2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='AK',])),]
chi_alpha_bc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='BC',])),]
chi_alpha_orwa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='OR-WA',])),]

chu_alpha2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum',])),]
chu_alpha_goa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='GOA',])),]
chu_alpha_bs2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='BS',])),]
chu_alpha_wc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='WC',])),]
chu_alpha_ak2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='AK',])),]
chu_alpha_bc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='BC',])),]
chu_alpha_orwa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='OR-WA',])),]

coh_alpha2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho',])),]
coh_alpha_goa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='GOA',])),]
coh_alpha_bs2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='BS',])),]
coh_alpha_wc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='WC',])),]
coh_alpha_ak2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='AK',])),]
coh_alpha_bc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='BC',])),]
coh_alpha_orwa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='OR-WA',])),]

pi_alpha2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink',])),]
pi_alpha_goa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='GOA',])),]
pi_alpha_bs2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='BS',])),]
pi_alpha_wc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='WC',])),]
pi_alpha_ak2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='AK',])),]
pi_alpha_bc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='BC',])),]
pi_alpha_orwa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='OR-WA',])),]

soc_alpha2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Sockeye',])),]
soc_alpha_goa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='GOA',])),]
soc_alpha_bs2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='BS',])),]
soc_alpha_wc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='WC',])),]
soc_alpha_ak2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='AK',])),]
soc_alpha_bc2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='BC',])),]
soc_alpha_orwa2=prod_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='OR-WA',])),]

#umsy matrices
chi_alphau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook',])),]
chi_alpha_goau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='GOA',])),]
chi_alpha_bsu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='BS',])),]
chi_alpha_wcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='WC',])),]
chi_alpha_aku=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='AK',])),]
chi_alpha_bcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='BC',])),]
chi_alpha_orwau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='OR-WA',])),]

chu_alphau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum',])),]
chu_alpha_goau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='GOA',])),]
chu_alpha_bsu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='BS',])),]
chu_alpha_wcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='WC',])),]
chu_alpha_aku=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='AK',])),]
chu_alpha_bcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='BC',])),]
chu_alpha_orwau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='OR-WA',])),]

coh_alphau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho',])),]
coh_alpha_goau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='GOA',])),]
coh_alpha_bsu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='BS',])),]
coh_alpha_wcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='WC',])),]
coh_alpha_aku=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='AK',])),]
coh_alpha_bcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='BC',])),]
coh_alpha_orwau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='OR-WA',])),]

pi_alphau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink',])),]
pi_alpha_goau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='GOA',])),]
pi_alpha_bsu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='BS',])),]
pi_alpha_wcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='WC',])),]
pi_alpha_aku=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='AK',])),]
pi_alpha_bcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='BC',])),]
pi_alpha_orwau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='OR-WA',])),]

soc_alphau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Sockeye',])),]
soc_alpha_goau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='GOA',])),]
soc_alpha_bsu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='BS',])),]
soc_alpha_wcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='WC',])),]
soc_alpha_aku=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='AK',])),]
soc_alpha_bcu=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='BC',])),]
soc_alpha_orwau=umsy_matr[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='OR-WA',])),]

#umsy scaled matrices
chi_alpha2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook',])),]
chi_alpha_goa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='GOA',])),]
chi_alpha_bs2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='BS',])),]
chi_alpha_wc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$ocean.basin=='WC',])),]
chi_alpha_ak2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='AK',])),]
chi_alpha_bc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='BC',])),]
chi_alpha_orwa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chinook'&stock_info_filtered$state2=='OR-WA',])),]

chu_alpha2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum',])),]
chu_alpha_goa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='GOA',])),]
chu_alpha_bs2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='BS',])),]
chu_alpha_wc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$ocean.basin=='WC',])),]
chu_alpha_ak2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='AK',])),]
chu_alpha_bc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='BC',])),]
chu_alpha_orwa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Chum'&stock_info_filtered$state2=='OR-WA',])),]

coh_alpha2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho',])),]
coh_alpha_goa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='GOA',])),]
coh_alpha_bs2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='BS',])),]
coh_alpha_wc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$ocean.basin=='WC',])),]
coh_alpha_ak2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='AK',])),]
coh_alpha_bc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='BC',])),]
coh_alpha_orwa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Coho'&stock_info_filtered$state2=='OR-WA',])),]

pi_alpha2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink',])),]
pi_alpha_goa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='GOA',])),]
pi_alpha_bs2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='BS',])),]
pi_alpha_wc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$ocean.basin=='WC',])),]
pi_alpha_ak2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='AK',])),]
pi_alpha_bc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='BC',])),]
pi_alpha_orwa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Pink'&stock_info_filtered$state2=='OR-WA',])),]

soc_alpha2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species2=='Sockeye',])),]
soc_alpha_goa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='GOA',])),]
soc_alpha_bs2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='BS',])),]
soc_alpha_wc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$ocean.basin=='WC',])),]
soc_alpha_ak2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='AK',])),]
soc_alpha_bc2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='BC',])),]
soc_alpha_orwa2u=umsy_matr2[as.numeric(rownames(stock_info_filtered[stock_info_filtered$species=='Sockeye'&stock_info_filtered$state2=='OR-WA',])),]

```

## Chinook

### Productivity

```{r, chi}
par(mar = c(4, 4, 1, 1),mfrow=c(1,1))
plot(rep(0,ncol(chi_alpha))~colnames(chi_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha)){
  lines(exp(chi_alpha)[i,]~colnames(chi_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chi_alpha));m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[1])

```

#### ocean region
```{r, chi or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alpha))~colnames(chi_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha_wc)){
  lines(exp(chi_alpha_wc)[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chi_alpha_wc));m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chi_alpha_goa)){
  lines(exp(chi_alpha_goa)[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chi_alpha_goa));m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chi_alpha_bs)){
  lines(exp(chi_alpha_bs)[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, chi st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alpha))~colnames(chi_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha_orwa)){
  lines(exp(chi_alpha_orwa)[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chi_alpha_orwa));m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chi_alpha_bc)){
  lines(exp(chi_alpha_bc)[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chi_alpha_bc));m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chi_alpha_ak)){
  lines(exp(chi_alpha_ak)[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chi_alpha_ak));m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```


### Scaled Productivity
```{r, chi sc}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alpha))~colnames(chi_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha)){
  lines(chi_alpha2[i,]~colnames(chi_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha2);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[1])
```

#### ocean region
```{r, chi sc or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alpha))~colnames(chi_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha_wc2)){
  lines(chi_alpha_wc2[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_wc2);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chi_alpha_goa2)){
  lines(chi_alpha_goa2[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_goa2);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chi_alpha_bs)){
  lines(chi_alpha_bs2[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, chi sc st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alpha))~colnames(chi_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha_orwa)){
  lines(chi_alpha_orwa2[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_orwa2);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chi_alpha_bc)){
  lines(chi_alpha_bc2[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_bc2);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chi_alpha_ak)){
  lines(chi_alpha_ak2[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_ak2);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Umsy

```{r, chi u}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alphau))~colnames(chi_alphau),ylim=c(-0.2,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha)){
  lines(chi_alphau[i,]~colnames(chi_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alphau);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[1])

```

#### ocean region
```{r, chi u or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alphau))~colnames(chi_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha_wcu)){
   lines(chi_alpha_wcu[i,]~colnames(chi_alpha_wcu),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_wcu);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chi_alpha_goau)){
  lines(chi_alpha_goau[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_goau);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chi_alpha_bsu)){
  lines(chi_alpha_bsu[i,]~colnames(chi_alpha_bsu),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, chi u st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alphau))~colnames(chi_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha_orwa)){
  lines(chi_alpha_orwau[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_orwau);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chi_alpha_bcu)){
  lines(chi_alpha_bcu[i,]~colnames(chi_alphau),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_bcu);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chi_alpha_aku)){
  lines(chi_alpha_aku[i,]~colnames(chi_alpha_aku),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_aku);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Umsy
```{r, chi us}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alpha2u))~colnames(chi_alpha),ylim=c(-1,1),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha2u)){
  lines(chi_alpha2u[i,]~colnames(chi_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha2u);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[1])
```

#### ocean region
```{r, chi us or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alpha))~colnames(chi_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha_wc2u)){
  lines(chi_alpha_wc2u[i,]~colnames(chi_alpha2u),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_wc2u);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chi_alpha_goa2u)){
  lines(chi_alpha_goa2u[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_goa2u);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chi_alpha_bs)){
  lines(chi_alpha_bs2[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, chi us st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chi_alpha))~colnames(chi_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chi_alpha_orwa2u)){
  lines(chi_alpha_orwa2u[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_orwa2u);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chi_alpha_bc2u)){
  lines(chi_alpha_bc2u[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_bc2u);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chi_alpha_ak2u)){
  lines(chi_alpha_ak2u[i,]~colnames(chi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chi_alpha_ak2u);m.prod.5f$y=colnames(chi_alpha)[1:c(ncol(chi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```


### Change in productivity
```{r, chi recent prod}
p_cols1=RColorBrewer::brewer.pal(n=10,name='RdYlBu')
p_change=exp(lt_prod_chi$r.alpha)/exp(lt_prod_chi$alpha)-1
cuts=cut(p_change, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]
breaks=hist(p_change,breaks=30)$breaks

par(mfrow=c(1,2))
plot(exp(r.alpha)~exp(alpha),data=lt_prod,ylab='Recent (last 10y) productivity (max. recruits/spawner)',xlab='Long-term average productivity (max. recruits/spawner)',bty='l',type='n',xlim=c(0,28),ylim=c(0,28))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(exp(alpha[i]),exp(r.alpha[i]))~rep(exp(alpha[i]),2),col=p_cols2[i],data=lt_prod_chi)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
points(exp(r.alpha)~exp(alpha),data=lt_prod_chi,bg=adjustcolor(sp_cols[1],alpha.f=0.2),col=adjustcolor(sp_cols[1],alpha.f=0.8),pch=21,cex=1)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_chu,bg=adjustcolor(sp_cols[2],alpha.f=0.2),col=adjustcolor(sp_cols[2],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)

break_cols=p_cols1[cut(as.numeric(breaks),breaks = c(seq(-1,1,length.out=10),3.5))]

hist(p_change,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','','','0','','','','1','','','','2','','','','3'))

summary(p_change)

```

### Change in Umsy

```{r, chi recent umsy}
p_change2=(lt_prod_chi$r.umsy)/(lt_prod_chi$umsy)-1
breaks=hist(p_change2,breaks=30)$breaks
cuts=cut(p_change2, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]


par(mfrow=c(1,2))
plot(r.umsy~umsy,data=lt_prod_chi,ylab='Recent (last 10y) Umsy',xlab='Long-term average Umsy',bty='l',type='n',xlim=c(0,1),ylim=c(0,1))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(r.umsy[i],umsy[i])~rep(umsy[i],2),col=p_cols2[i],data=lt_prod_chi)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
points(r.umsy~umsy,data=lt_prod_chi,bg=adjustcolor(sp_cols[1],alpha.f=0.2),col=adjustcolor(sp_cols[1],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_chu,bg=adjustcolor(sp_cols[2],alpha.f=0.2),col=adjustcolor(sp_cols[2],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)




hist(p_change2,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','','','0','','','','1','','','','2','','','','3'))
 
```



## Chum
### Productivity

```{r, chu}
par(mar = c(4, 4, 1, 1),mfrow=c(1,1))
plot(rep(0,ncol(chu_alpha))~colnames(chu_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha)){
  lines(exp(chu_alpha)[i,]~colnames(chu_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chu_alpha));m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[2])

```

#### ocean region
```{r, chu or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alpha))~colnames(chu_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha_wc)){
  lines(exp(chu_alpha_wc)[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chu_alpha_wc));m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chu_alpha_goa)){
  lines(exp(chu_alpha_goa)[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chu_alpha_goa));m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chu_alpha_bs)){
  lines(exp(chu_alpha_bs)[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chu_alpha_bs));m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])


text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, chu st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alpha))~colnames(chu_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha_orwa)){
  lines(exp(chu_alpha_orwa)[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chu_alpha_orwa));m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chu_alpha_bc)){
  lines(exp(chu_alpha_bc)[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chu_alpha_bc));m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chu_alpha_ak)){
  lines(exp(chu_alpha_ak)[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(chu_alpha_ak));m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Productivity
```{r, chu s}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alpha))~colnames(chu_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha)){
  lines(chu_alpha2[i,]~colnames(chu_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha2);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[2])
```

#### ocean region
```{r, chu s or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alpha))~colnames(chu_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha_wc2)){
  lines(chu_alpha_wc2[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_wc2);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chu_alpha_goa2)){
  lines(chu_alpha_goa2[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_goa2);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chu_alpha_bs)){
  lines(chu_alpha_bs2[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_bs2);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, chu s st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alpha))~colnames(chu_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha_orwa)){
  lines(chu_alpha_orwa2[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_orwa2);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chu_alpha_bc)){
  lines(chu_alpha_bc2[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_bc2);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chu_alpha_ak)){
  lines(chu_alpha_ak2[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_ak2);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Umsy

```{r, chu u}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alphau))~colnames(chu_alphau),ylim=c(-0.2,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha)){
  lines(chu_alphau[i,]~colnames(chu_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alphau);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[2])

```

#### ocean region
```{r, chu u or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alphau))~colnames(chu_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha_wcu)){
   lines(chu_alpha_wcu[i,]~colnames(chu_alpha_wcu),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_wcu);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chu_alpha_goau)){
  lines(chu_alpha_goau[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_goau);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chu_alpha_bsu)){
  lines(chu_alpha_bsu[i,]~colnames(chu_alpha_bsu),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_bsu);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, chu u st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alphau))~colnames(chu_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha_orwa)){
  lines(chu_alpha_orwau[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_orwau);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chu_alpha_bcu)){
  lines(chu_alpha_bcu[i,]~colnames(chu_alphau),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_bcu);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chu_alpha_aku)){
  lines(chu_alpha_aku[i,]~colnames(chu_alpha_aku),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_aku);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Umsy
```{r, chu us}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alpha2u))~colnames(chu_alpha),ylim=c(-1,1),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha2u)){
  lines(chu_alpha2u[i,]~colnames(chu_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha2u);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[2])
```

#### ocean region
```{r, chu us or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alpha))~colnames(chu_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha_wc2u)){
  lines(chu_alpha_wc2u[i,]~colnames(chu_alpha2u),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_wc2u);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chu_alpha_goa2u)){
  lines(chu_alpha_goa2u[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_goa2u);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chu_alpha_bs)){
  lines(chu_alpha_bs2[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_bs2u);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, chu us st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(chu_alpha))~colnames(chu_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(chu_alpha_orwa2u)){
  lines(chu_alpha_orwa2u[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_orwa2u);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(chu_alpha_bc2u)){
  lines(chu_alpha_bc2u[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_bc2u);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(chu_alpha_ak2u)){
  lines(chu_alpha_ak2u[i,]~colnames(chu_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(chu_alpha_ak2u);m.prod.5f$y=colnames(chu_alpha)[1:c(ncol(chu_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Change in productivity
```{r, chu recent prod}
p_cols1=RColorBrewer::brewer.pal(n=10,name='RdYlBu')
p_change=exp(lt_prod_chu$r.alpha)/exp(lt_prod_chu$alpha)-1
cuts=cut(p_change, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]
breaks=hist(p_change,breaks=30)$breaks

par(mfrow=c(1,2))
plot(exp(r.alpha)~exp(alpha),data=lt_prod,ylab='Recent (last 10y) productivity (max. recruits/spawner)',xlab='Long-term average productivity (max. recruits/spawner)',bty='l',type='n',xlim=c(0,28),ylim=c(0,28))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(exp(alpha[i]),exp(r.alpha[i]))~rep(exp(alpha[i]),2),col=p_cols2[i],data=lt_prod_chu)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_chu,bg=adjustcolor(sp_cols[1],alpha.f=0.2),col=adjustcolor(sp_cols[1],alpha.f=0.8),pch=21,cex=1)
points(exp(r.alpha)~exp(alpha),data=lt_prod_chu,bg=adjustcolor(sp_cols[2],alpha.f=0.2),col=adjustcolor(sp_cols[2],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)

break_cols=p_cols1[cut(as.numeric(breaks),breaks = c(seq(-1,1,length.out=10),3.5))]

hist(p_change,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','','','0','','','','1','','','','2','','','','3'))

summary(p_change)

```

### Change in Umsy

```{r, chu recent umsy}
p_change2=(lt_prod_chu$r.umsy)/(lt_prod_chu$umsy)-1
breaks=hist(p_change2,breaks=30)$breaks
cuts=cut(p_change2, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]


par(mfrow=c(1,2))
plot(r.umsy~umsy,data=lt_prod_chu,ylab='Recent (last 10y) Umsy',xlab='Long-term average Umsy',bty='l',type='n',xlim=c(0,1),ylim=c(0,1))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(r.umsy[i],umsy[i])~rep(umsy[i],2),col=p_cols2[i],data=lt_prod_chu)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
points(r.umsy~umsy,data=lt_prod_chu,bg=adjustcolor(sp_cols[2],alpha.f=0.2),col=adjustcolor(sp_cols[2],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_chu,bg=adjustcolor(sp_cols[2],alpha.f=0.2),col=adjustcolor(sp_cols[2],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)




hist(p_change2,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','','','0','','','','1','','','','2','','','','3'))
 
```

## Coho
### Productivity

```{r, coh}
par(mar = c(4, 4, 1, 1),mfrow=c(1,1))
plot(rep(0,ncol(coh_alpha))~colnames(coh_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha)){
  lines(exp(coh_alpha)[i,]~colnames(coh_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(coh_alpha));m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[3])

```

#### ocean region
```{r, coh or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alpha))~colnames(coh_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha_wc)){
  lines(exp(coh_alpha_wc)[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(coh_alpha_wc));m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(coh_alpha_goa)){
  lines(exp(coh_alpha_goa)[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(coh_alpha_goa));m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])


text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])

```

#### state
```{r, coh st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alpha))~colnames(coh_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha_orwa)){
  lines(exp(coh_alpha_orwa)[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(coh_alpha_orwa));m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(coh_alpha_bc)){
  lines(exp(coh_alpha_bc)[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(coh_alpha_bc));m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(coh_alpha_ak)){
  lines(exp(coh_alpha_ak)[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(coh_alpha_ak));m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Productivity
```{r, coh s}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alpha))~colnames(coh_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha)){
  lines(coh_alpha2[i,]~colnames(coh_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha2);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[3])
```

#### ocean region
```{r, coh s or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alpha))~colnames(coh_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha_wc2)){
  lines(coh_alpha_wc2[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_wc2);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(coh_alpha_goa2)){
  lines(coh_alpha_goa2[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_goa2);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])

```

#### state
```{r, coh s st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alpha))~colnames(coh_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha_orwa)){
  lines(coh_alpha_orwa2[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_orwa2);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(coh_alpha_bc)){
  lines(coh_alpha_bc2[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_bc2);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(coh_alpha_ak)){
  lines(coh_alpha_ak2[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_ak2);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Umsy

```{r, coh u}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alphau))~colnames(coh_alphau),ylim=c(-0.2,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha)){
  lines(coh_alphau[i,]~colnames(coh_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alphau);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[3])

```

#### ocean region
```{r, coh u or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alphau))~colnames(coh_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha_wcu)){
   lines(coh_alpha_wcu[i,]~colnames(coh_alpha_wcu),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_wcu);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(coh_alpha_goau)){
  lines(coh_alpha_goau[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_goau);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])

```

#### state
```{r, coh u st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alphau))~colnames(coh_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha_orwa)){
  lines(coh_alpha_orwau[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_orwau);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(coh_alpha_bcu)){
  lines(coh_alpha_bcu[i,]~colnames(coh_alphau),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_bcu);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(coh_alpha_aku)){
  lines(coh_alpha_aku[i,]~colnames(coh_alpha_aku),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_aku);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Umsy
```{r, coh us}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alpha2u))~colnames(coh_alpha),ylim=c(-1,1),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha2u)){
  lines(coh_alpha2u[i,]~colnames(coh_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha2u);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[3])
```

#### ocean region
```{r, coh us or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alpha))~colnames(coh_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha_wc2u)){
  lines(coh_alpha_wc2u[i,]~colnames(coh_alpha2u),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_wc2u);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(coh_alpha_goa2u)){
  lines(coh_alpha_goa2u[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_goa2u);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])

```

#### state
```{r, coh us st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(coh_alpha))~colnames(coh_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(coh_alpha_orwa2u)){
  lines(coh_alpha_orwa2u[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_orwa2u);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(coh_alpha_bc2u)){
  lines(coh_alpha_bc2u[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_bc2u);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(coh_alpha_ak2u)){
  lines(coh_alpha_ak2u[i,]~colnames(coh_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(coh_alpha_ak2u);m.prod.5f$y=colnames(coh_alpha)[1:c(ncol(coh_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Change in productivity
```{r, coh recent prod}
p_cols1=RColorBrewer::brewer.pal(n=10,name='RdYlBu')
p_change=exp(lt_prod_coh$r.alpha)/exp(lt_prod_coh$alpha)-1
cuts=cut(p_change, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]
breaks=hist(p_change,breaks=30)$breaks

par(mfrow=c(1,2))
plot(exp(r.alpha)~exp(alpha),data=lt_prod,ylab='Recent (last 10y) productivity (max. recruits/spawner)',xlab='Long-term average productivity (max. recruits/spawner)',bty='l',type='n',xlim=c(0,28),ylim=c(0,28))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(exp(alpha[i]),exp(r.alpha[i]))~rep(exp(alpha[i]),2),col=p_cols2[i],data=lt_prod_coh)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_coh,bg=adjustcolor(sp_cols[1],alpha.f=0.2),col=adjustcolor(sp_cols[1],alpha.f=0.8),pch=21,cex=1)
points(exp(r.alpha)~exp(alpha),data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)

break_cols=p_cols1[cut(as.numeric(breaks),breaks = c(seq(-1,1,length.out=10),3.5))]

hist(p_change,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','-0.5','-0.25','','0','0.25','','','1','','','','2','','','','3'))

summary(p_change)

```

### Change in Umsy

```{r, coh recent umsy}
p_change2=(lt_prod_coh$r.umsy)/(lt_prod_coh$umsy)-1
breaks=hist(p_change2,breaks=30)$breaks
cuts=cut(p_change2, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]


par(mfrow=c(1,2))
plot(r.umsy~umsy,data=lt_prod_coh,ylab='Recent (last 10y) Umsy',xlab='Long-term average Umsy',bty='l',type='n',xlim=c(0,1),ylim=c(0,1))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(r.umsy[i],umsy[i])~rep(umsy[i],2),col=p_cols2[i],data=lt_prod_coh)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
points(r.umsy~umsy,data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_coh,bg=adjustcolor(sp_cols[2],alpha.f=0.2),col=adjustcolor(sp_cols[2],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)




hist(p_change2,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','-0.5','-0.25','0','','','','1','','','','2','','','','3'))
 
```

## Pink
### Productivity

```{r, pi}
par(mar = c(4, 4, 1, 1),mfrow=c(1,1))
plot(rep(0,ncol(pi_alpha))~colnames(pi_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha)){
  lines(exp(pi_alpha)[i,]~colnames(pi_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(pi_alpha));m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[4], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[4])

```

#### ocean region
```{r, pi or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alpha))~colnames(pi_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha_wc)){
  lines(exp(pi_alpha_wc)[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(pi_alpha_wc));m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(pi_alpha_goa)){
  lines(exp(pi_alpha_goa)[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(pi_alpha_goa));m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(pi_alpha_bs)){
  lines(exp(pi_alpha_bs)[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(pi_alpha_bs));m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])


text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, pi st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alpha))~colnames(pi_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha_orwa)){
  lines(exp(pi_alpha_orwa)[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(pi_alpha_orwa));m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(pi_alpha_bc)){
  lines(exp(pi_alpha_bc)[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(pi_alpha_bc));m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(pi_alpha_ak)){
  lines(exp(pi_alpha_ak)[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(pi_alpha_ak));m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Productivity
```{r, pi sc}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alpha))~colnames(pi_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha)){
  lines(pi_alpha2[i,]~colnames(pi_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha2);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[4], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[4])
```

#### ocean region
```{r, pi sc or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alpha))~colnames(pi_alpha),ylim=c(-3,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha_wc2)){
  lines(pi_alpha_wc2[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_wc2);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(pi_alpha_goa2)){
  lines(pi_alpha_goa2[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_goa2);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(pi_alpha_bs)){
  lines(pi_alpha_bs2[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_bs2);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, pi sc st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alpha))~colnames(pi_alpha),ylim=c(-3,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha_orwa)){
  lines(pi_alpha_orwa2[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_orwa2);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(pi_alpha_bc)){
  lines(pi_alpha_bc2[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_bc2);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(pi_alpha_ak)){
  lines(pi_alpha_ak2[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_ak2);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Umsy

```{r, pi u}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alphau))~colnames(pi_alphau),ylim=c(-0.2,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha)){
  lines(pi_alphau[i,]~colnames(pi_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alphau);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[3], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[3])

```

#### ocean region
```{r, pi u or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alphau))~colnames(pi_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha_wcu)){
   lines(pi_alpha_wcu[i,]~colnames(pi_alpha_wcu),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_wcu);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(pi_alpha_goau)){
  lines(pi_alpha_goau[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_goau);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(pi_alpha_bsu)){
  lines(pi_alpha_bsu[i,]~colnames(pi_alpha_bsu),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_bsu);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, pi u st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alphau))~colnames(pi_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha_orwa)){
  lines(pi_alpha_orwau[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_orwau);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(pi_alpha_bcu)){
  lines(pi_alpha_bcu[i,]~colnames(pi_alphau),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_bcu);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(pi_alpha_aku)){
  lines(pi_alpha_aku[i,]~colnames(pi_alpha_aku),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_aku);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Umsy
```{r, pi us }
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alpha2u))~colnames(pi_alpha),ylim=c(-1,1),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha2u)){
  lines(pi_alpha2u[i,]~colnames(pi_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha2u);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[2])
```

#### ocean region
```{r, pi us or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alpha))~colnames(pi_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha_wc2u)){
  lines(pi_alpha_wc2u[i,]~colnames(pi_alpha2u),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_wc2u);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(pi_alpha_goa2u)){
  lines(pi_alpha_goa2u[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_goa2u);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(pi_alpha_bs)){
  lines(pi_alpha_bs2[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_bs2u);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, pi us st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(pi_alpha))~colnames(pi_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(pi_alpha_orwa2u)){
  lines(pi_alpha_orwa2u[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_orwa2u);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(pi_alpha_bc2u)){
  lines(pi_alpha_bc2u[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_bc2u);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(pi_alpha_ak2u)){
  lines(pi_alpha_ak2u[i,]~colnames(pi_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(pi_alpha_ak2u);m.prod.5f$y=colnames(pi_alpha)[1:c(ncol(pi_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Change in productivity
```{r, pi recent prod}
p_cols1=RColorBrewer::brewer.pal(n=10,name='RdYlBu')
p_change=exp(lt_prod_pi$r.alpha)/exp(lt_prod_pi$alpha)-1
cuts=cut(p_change, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]
breaks=hist(p_change,breaks=30)$breaks

par(mfrow=c(1,2))
plot(exp(r.alpha)~exp(alpha),data=lt_prod,ylab='Recent (last 10y) productivity (max. recruits/spawner)',xlab='Long-term average productivity (max. recruits/spawner)',bty='l',type='n',xlim=c(0,28),ylim=c(0,28))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(exp(alpha[i]),exp(r.alpha[i]))~rep(exp(alpha[i]),2),col=p_cols2[i],data=lt_prod_pi)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_pi,bg=adjustcolor(sp_cols[1],alpha.f=0.2),col=adjustcolor(sp_cols[1],alpha.f=0.8),pch=21,cex=1)
points(exp(r.alpha)~exp(alpha),data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)

break_cols=p_cols1[cut(as.numeric(breaks),breaks = c(seq(-1,1,length.out=10),3.5))]

hist(p_change,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','-0.5','-0.25','','0','0.25','','','1','','','','2','','','','3'))

summary(p_change)

```

### Change in Umsy

```{r, pi recent umsy}
p_change2=(lt_prod_pi$r.umsy)/(lt_prod_pi$umsy)-1
breaks=hist(p_change2,breaks=30)$breaks
cuts=cut(p_change2, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]


par(mfrow=c(1,2))
plot(r.umsy~umsy,data=lt_prod_pi,ylab='Recent (last 10y) Umsy',xlab='Long-term average Umsy',bty='l',type='n',xlim=c(0,1),ylim=c(0,1))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(r.umsy[i],umsy[i])~rep(umsy[i],2),col=p_cols2[i],data=lt_prod_pi)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
points(r.umsy~umsy,data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_pi,bg=adjustcolor(sp_cols[2],alpha.f=0.2),col=adjustcolor(sp_cols[2],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_pi,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_pi,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)




hist(p_change2,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','-0.5','-0.25','0','0.25','0.5','0.75','1','','','','2','','','','3'))
 
```


## Sockeye
### Productivity

```{r, soc}
par(mar = c(4, 4, 1, 1),mfrow=c(1,1))
plot(rep(0,ncol(soc_alpha))~colnames(soc_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha)){
  lines(exp(soc_alpha)[i,]~colnames(soc_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(soc_alpha));m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[5], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[5])

```

#### ocean region
```{r, soc or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alpha))~colnames(soc_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha_wc)){
  lines(exp(soc_alpha_wc)[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(soc_alpha_wc));m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(soc_alpha_goa)){
  lines(exp(soc_alpha_goa)[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(soc_alpha_goa));m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(soc_alpha_bs)){
  lines(exp(soc_alpha_bs)[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(soc_alpha_bs));m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])


text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, soc st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alpha))~colnames(soc_alpha),ylim=c(0,25),ylab='Max. recruits/spawner',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha_bc)){
  lines(exp(soc_alpha_bc)[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(soc_alpha_bc));m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(soc_alpha_ak)){
  lines(exp(soc_alpha_ak)[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(exp(soc_alpha_ak));m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Productivity
```{r,soc sc}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alpha))~colnames(soc_alpha),ylim=c(-2,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha)){
  lines(soc_alpha2[i,]~colnames(soc_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha2);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[5], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[5])
```

#### ocean region
```{r, soc sc ob}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alpha))~colnames(soc_alpha),ylim=c(-3,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha_wc2)){
  lines(soc_alpha_wc2[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_wc2);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(soc_alpha_goa2)){
  lines(soc_alpha_goa2[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_goa2);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(soc_alpha_bs)){
  lines(soc_alpha_bs2[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_bs2);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, soc sc st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alpha))~colnames(soc_alpha),ylim=c(-3,2),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha_bc)){
  lines(soc_alpha_bc2[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_bc2);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(soc_alpha_ak)){
  lines(soc_alpha_ak2[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_ak2);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Umsy

```{r, soc u}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alphau))~colnames(soc_alphau),ylim=c(-0.2,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha)){
  lines(soc_alphau[i,]~colnames(soc_alpha),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alphau);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[3], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[3])

```

#### ocean region
```{r, soc u og}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alphau))~colnames(soc_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha_wcu)){
   lines(soc_alpha_wcu[i,]~colnames(soc_alpha_wcu),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_wcu);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(soc_alpha_goau)){
  lines(soc_alpha_goau[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_goau);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(soc_alpha_bsu)){
  lines(soc_alpha_bsu[i,]~colnames(soc_alpha_bsu),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_bsu);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r, soc u st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alphau))~colnames(soc_alphau),ylim=c(-0.25,1),ylab='Sustainable harvest rate (Umsy)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha_bcu)){
  lines(soc_alpha_bcu[i,]~colnames(soc_alphau),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_bcu);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(soc_alpha_aku)){
  lines(soc_alpha_aku[i,]~colnames(soc_alpha_aku),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_aku);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Scaled Umsy
```{r, soc us}
#broken?? why?
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alpha2u))~colnames(soc_alpha),ylim=c(-1,1),ylab='Deviations from median log(alpha)',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha2u)){
  lines(soc_alpha2u[i,]~colnames(soc_alpha2),col=adjustcolor('darkgray',alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha2u);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(sp_cols[1], alpha = 0.3), border=NA) # Add uncertainty polygon
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=sp_cols[2])
```

#### ocean region
```{r,soc us or}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alpha))~colnames(soc_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha_wc2u)){
  lines(soc_alpha_wc2u[i,]~colnames(soc_alpha2u),col=adjustcolor(basin_cols[1],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_wc2u);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[1], alpha = 0.3), border=NA)
lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[1])
for(i in 1:nrow(soc_alpha_goa2u)){
  lines(soc_alpha_goa2u[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_goa2u);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(soc_alpha_bs)){
  lines(soc_alpha_bs2[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_bs2u);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'West Coast',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'Gulf of Alaska',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Bering Sea',col=basin_cols[3])
```

#### state
```{r,soc us st}
par(mar = c(4, 4, 1, 1))
plot(rep(0,ncol(soc_alpha))~colnames(soc_alpha),ylim=c(-1,1),ylab='Deviations from median Umsy',type='n',bty='l',xlab='Brood cohort year',xaxt='n')
axis(side=1,at=seq(1950,2020,by=5))
for(i in 1:nrow(soc_alpha_bc2u)){
  lines(soc_alpha_bc2u[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[2],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_bc2u);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[2], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[2])
for(i in 1:nrow(soc_alpha_ak2u)){
  lines(soc_alpha_ak2u[i,]~colnames(soc_alpha),col=adjustcolor(basin_cols[3],alpha.f=0.3))
}
m.prod.5f=move_avg_mat(soc_alpha_ak2u);m.prod.5f$y=colnames(soc_alpha)[1:c(ncol(soc_alpha)-2)]
m.prod.5f=m.prod.5f[complete.cases(m.prod.5f[,1]),]
x<- c(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)]), rev(seq(m.prod.5f$y[1],m.prod.5f$y[nrow(m.prod.5f)])))
y<- c(m.prod.5f[,1]-2*m.prod.5f[,2], rev(m.prod.5f[,1]+2*m.prod.5f[,2]))
polygon(x, y, col = adjustcolor(basin_cols[3], alpha = 0.3), border=NA)

lines(m.prod.5f[,1]~seq(min(x),max(x)),lwd=2,col=basin_cols[3])

text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.1,'Oregon/Washington',col=basin_cols[1])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.2,'British Columbia',col=basin_cols[2])
text(x=par('usr')[2]-(par('usr')[2]-par('usr')[1])*0.1,y=par('usr')[4]-(par('usr')[4]-par('usr')[3])*0.3,'Alaska',col=basin_cols[3])

```

### Change in productivity
```{r, soc recent prod}
p_cols1=RColorBrewer::brewer.pal(n=10,name='RdYlBu')
p_change=exp(lt_prod_soc$r.alpha)/exp(lt_prod_soc$alpha)-1
cuts=cut(p_change, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]
breaks=hist(p_change,breaks=30)$breaks

par(mfrow=c(1,2))
plot(exp(r.alpha)~exp(alpha),data=lt_prod,ylab='Recent (last 10y) productivity (max. recruits/spawner)',xlab='Long-term average productivity (max. recruits/spawner)',bty='l',type='n',xlim=c(0,28),ylim=c(0,28))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(exp(alpha[i]),exp(r.alpha[i]))~rep(exp(alpha[i]),2),col=p_cols2[i],data=lt_prod_soc)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_soc,bg=adjustcolor(sp_cols[1],alpha.f=0.2),col=adjustcolor(sp_cols[1],alpha.f=0.8),pch=21,cex=1)
points(exp(r.alpha)~exp(alpha),data=lt_prod_soc,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_coh,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_soc,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(exp(r.alpha)~exp(alpha),data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)

break_cols=p_cols1[cut(as.numeric(breaks),breaks = c(seq(-1,1,length.out=10),3.5))]

hist(p_change,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','-0.5','-0.25','','0','0.25','','','1','','','','2','','','','3'))

summary(p_change)

```

### Change in Umsy

```{r, soc recent umsy}
p_change2=(lt_prod_soc$r.umsy)/(lt_prod_soc$umsy)-1
breaks=hist(p_change2,breaks=30)$breaks
cuts=cut(p_change2, breaks = c(seq(-1,1,length.out=10),3.5))
p_cols2=p_cols1[as.numeric(cuts)]


par(mfrow=c(1,2))
plot(r.umsy~umsy,data=lt_prod_soc,ylab='Recent (last 10y) Umsy',xlab='Long-term average Umsy',bty='l',type='n',xlim=c(0,1),ylim=c(0,1))
abline(0,1)
for(i in 1:nrow(stock_info_filtered)){
  lines(c(r.umsy[i],umsy[i])~rep(umsy[i],2),col=p_cols2[i],data=lt_prod_soc)
}
#points(exp(r.alpha)~exp(alpha),data=lt_prod,bg=adjustcolor('darkgray',alpha.f=0.2),col=adjustcolor('black',alpha.f=0.8),pch=21,cex=1)
points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[2],alpha.f=0.2),col=adjustcolor(sp_cols[2],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[3],alpha.f=0.2),col=adjustcolor(sp_cols[3],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[4],alpha.f=0.2),col=adjustcolor(sp_cols[4],alpha.f=0.8),pch=21,cex=1.2)
#points(r.umsy~umsy,data=lt_prod_soc,bg=adjustcolor(sp_cols[5],alpha.f=0.2),col=adjustcolor(sp_cols[5],alpha.f=0.8),pch=21,cex=1.2)




hist(p_change2,breaks=30,xlab='Proportional change relative to long-term average',main='',col=break_cols,xaxt='n')
axis(side=1,at=c(seq(-1,3,by=0.25)),labels=c('-1','','-0.5','-0.25','0','0.25','0.5','0.75','1','','','','2','','','','3'))
 
```
